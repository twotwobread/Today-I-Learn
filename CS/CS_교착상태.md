# 01 교착 상태의 개요
## 1 교착 상태의 정의
> 교착 상태 (deadlock) : 2개 이상의 프로세스가 다른 프로세스의 작업이 끝나기만 기다리며 작업을 더 이상 진행하지 못하는 상태  
- 교착 상태와 아사 현상의 차이점
  + 아사 현상 : OS가 잘못된 정책을 사용하여 특정 프로세스의 작업이 지연되는 문제
  + 교착 상태 : 여러 프로세스가 작업을 진행하다 보니 자연적으로 발생하는 문제
  + 따라서 OS는 감시를 하다가 교착 상태가 발생 시 강압적으로 해결해야 함.
## 2 교착 상태의 발생
- 시스템 자원
  + 다른 프로세스와 공유할 수 없는 자원 사용 시 발생.
    - ex. P1은 프린터를 할당받고 CD 레코더를 기다리고 P2는 CD 레코더를 할당받고 프린터를 기다리는 상황.
- 공유 변수
  + 무한 대기를 막지 못하는 경우 교착 상태 발생.
    - ex. P1과 P2가 같이 cs에 접근시도를 하면서 lock1, lock2가 모두 true가 되는 경우 무한 대기가 발생하고 한 변 수를 할당받은 상태에서 다른 변수를 기다리면서 교착 상태 발생.
- 응용 프로그램
  + 데이터베이스 같은 응용 프로그램에서도 교착 상태 발생.
  + 여러 프로세스가 데이터 베이스에 저장된 데이터를 사용하는 경우 일관성을 유지해야 함.
    - ex. 프로세스가 데이터 베이스에 동시에 접근을 하면서 일관성이 깨지는 경우 발생 -> 이걸 막기 위해 lock을 이용하는데 이 경우 교착 상태 발생 가능.
## 3 자원 할당 그래프
- 프로세스가 어떤 자원을 사용 중이고 어떤 자원을 기다리고 있는지를 방향성이 있는 그래프로 표현한 것.
- 프로세스는 원, 자원은 네모로 표시하고 자원을 할당받고 있는 경우는 실선으로 자원 -> 프로세스, 자원을 기다리고 있는 경우 실선으로 프로세스 -> 자원
- 2개 이상의 프로세스를 할당 받을 수 있는 자원 존재
  + 여러 프로세스가 하나의 자원을 동시에 이용하는 경우 : 다중자원, 사각형안에 점의 갯수로 사용가능한 자원의 갯수 표현.
- 예로 식사하는 철학자 문제를 살펴보자.
  + 철학자 4명이 둥근 식탁에 둘러앉아 식사를 하는데, 왼쪽의 포크를 잡고 오른쪽의 포크를 잡아야만 식사가 가능하다는 조건이 존재.
  + 이 경우 철학자들은 왼쪽 포크를 집고 오른쪽을 보지만 이미 다른 철학자가 왼손으로 포크를 집고 있을 것.
  + 그럼 오른쪽 포크를 모두 집지 못해 굶어 죽는다는 문제.
  + 교착 상태로 생각하면 P1~P4가 자원 R1~R4를 할당받고 다른 자원을 계속 기다리는 경우 교착 상태 발생.
  + 해당 문제에서 교착 상태가 발생하는 조건
    1. 철학자들은 서로 포크를 공유할 수 없음. -> 자원을 공유하지 못하면 교착 상태가 발생.
    2. 각 철학자는 다른 철학자의 포크를 빼앗을 수 없음. -> 자원을 빼앗을 수 없기에 자원 할당 해제까지 대기해야 하여 교착 상태 발생.
    3. 각 철학자는 왼쪽 포크를 잡을 채 오른쪽 포크를 기다림. -> 자원 하나를 잡은 상태에서 다른 자원을 기다리면 교착 상태 발생.
    4. 자원 할당 그래프가 원형임. -> 자원을 요구하는 방향이 원을 이루면 양보를 하지 않기 때문에 교착 상태 발생.
# 02 교착 상태 필요 조건
## 1 교착 상태 필요조건
> 교착상태는 아래의 조건을 모두 충족할 시 발생 -> 하나라도 충족하지 않으면 발생 X  
- 상호 배제( mutual exclusion ) : 배타적 자원은 cs로 보호되어 다른 프로세스가 동시에 사용 불가 -> 배타적 자원을 사용하면 교착 상태 발생.
  + 배타적 자원 : 한 프로세스가 사용하는 자원 ( 다른 프로세스와 공유 불가 )
- 비선점( non-preemption ) : 자원을 빼앗을 수 없는 경우 공유할 수 없어서 교착 상태 발생.
- 점유와 대기( hold and wait ) : 프로세스가 어떤 자원을 할당받은 상태에서 다른 자원을 기다리는 상태.
  + 다른 프로세스를 방해하려면 다른 프로세스가 원하는 자원을 할당받은 상태에서 다른 자원을 기다려야 함.
- 원형 대기( circular wait ) : 점유와 대기 중인 프로세스 간의 관계가 원을 이루어야 함.
  + 점유와 대기 중인 프로세스들이 서로 방해하는 방향이 원을 이뤄야 서로 양보하지 않기에 교착 상태 발생.
## 2 식사하는 철학자 문제와 교착 상태 필요조건
- 상호 배제 : 포크는 한 사람이 이용하면 다른 사람이 이용할 수 없는 배타적 자원.
- 비선점 : 자원을 빼앗을 수 있다면 교착 상태 발생 X, 포크를 못빼앗는 경우 발생.
  + 상호 배제와 비선점은 cs와 관련 -> lock을 사용하면 위 두 조건이 보장됨.
- 점유와 대기 : 한 철학자가 왼쪽, 오른쪽 포크를 모두 점유하거나, 반대로 두 자원 모두 기다리면 교착 상태 발생 X
- 원형 대기 : 점유와 대기가 원을 이뤄야함 -> 그래야 다른 프로세스를 방해하고 그것이 모든 프로세스에 적용이 됨.
- 위에서도 얘기했듯 아사와 교착은 다름.
  + 아사 현상: 최단 작업 우선 스케줄링 알고리즘에서 작업 시간이 긴 프로세스가 작업 시간이 짧은 프로세스 때문에 작업이 진행되지 못하는 경우 발생.
    - 이는 몇 번 이상 양보하면 더 이상 양보하지 않도록 조정하는 에이징으로 해결 가능.
  + 교착 상태 : 정책상 잘못이나 오류가 없어도 자연적으로 발생 -> 에이징으로 해결 불가하고 정책을 바꿔도 해결 불가.
    - 아사 현상보다 처리하기가 복잡.







